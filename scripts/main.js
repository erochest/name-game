"use strict";function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}();!function(){function t(){return localforage.getItem(S).then(function(t){return t=null===t?new b:b.fromObject(t)})}function n(){return localforage.setItem(S,new b)}function e(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return t().then(function(t){return t.addAttempt(n),t}).then(function(t){return localforage.setItem(S,t)})}function r(t){var n=document.querySelector("#stats"),e='\n      <span class="attempts">'+t.attempts+'</span> tries   /\n      <span class="correct" >'+t.correct+'</span> correct /\n      <span class="streak"  >'+t.streak+"</span> streak\n      ";return n.innerHTML=e,t}function a(t){var n=t();return n.then(function(){return a(t)})}function o(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise(function(e,r){window.setTimeout(function(){return e(n)},t)})}function u(t){return Math.round(Math.random()*t)}function c(t,n){return l(i(t,n))}function i(t,n){var e=t.map(function(t){return{value:t,weight:n(t)}}).sort(function(t,n){return n-t}),r=e.reduce(function(t,n){return t+n.weight},0);return e.forEach(function(t){return t.weight=t.weight/r}),e}function l(t){var n=Math.random(),e=0,r=null,a=!0,o=!1,u=void 0;try{for(var c,i=t[Symbol.iterator]();!(a=(c=i.next()).done);a=!0){var l=c.value;if(e+=l.weight,r=l.value,e>=n)break}}catch(t){o=!0,u=t}finally{try{!a&&i.return&&i.return()}finally{if(o)throw u}}return r}function s(t,n,e){var r=t;if(n<t.length){var a=new Set,o=i(t,e);for(r=[];r.length<n;){var u=l(o);a.has(u.url)||(a.add(u.url),r.push(u))}}return r}function f(t,n){var e=document.querySelector("#name");e.innerText=n.name,e.dataset.n=t}function h(t){var n=document.querySelector("#gallery div"),e="";t.forEach(function(t,n){e+='\n        <div class="photo">\n          <div data-n="'+n+'" class="shade"></div>\n          <div class="name">'+t.name+'</div>\n          <img src="'+t.url+'">\n        </div>\n        '}),n.innerHTML=e}function d(t,n){var a=document.querySelectorAll("#gallery .photo");a.forEach(function(a){a.addEventListener("click",function(a){var u=document.querySelector("#name");if(u.dataset.n===a.target.dataset.n){var c=n[u.dataset.n];a.target.parentElement.classList.add("correct"),c.last_correct=new Date,e(!0).then(r).then(function(){return g(c)}).then(function(){return o(3500)}).then(t)}else a.target.parentElement.classList.add("wrong"),e(!1).then(r)},{once:!0})})}function m(t){var n=new Date,e=s(t,k,function(t){return n-t.last_correct}),r=u(k-1),a=e[r];return new Promise(function(t,n){f(r,a),h(e),d(t,e)})}function v(t){return Promise.all(t.map(w))}function w(t){var n=t.url;return localforage.getItem(n).then(function(e){var r=null;return r=null===e?localforage.setItem(n,t):Promise.resolve(e)}).then(function(t){return new _(t)})}function g(t){return localforage.setItem(t.url,t)}function p(){return localforage.keys().then(function(t){return Promise.all(t.filter(function(t){return t!==S}).map(function(t){return localforage.getItem(t)}))}).then(function(t){return t.filter(function(t){return null!==t}).map(function(t){return new _(t)})})}function y(){t().then(r),$.getJSON("http://api.namegame.willowtreemobile.com/").done(function(t){return v(t.map(function(t){return new _(t)})).then(function(t){return a(function(){return m(t)})})})}var k=5,S="stats",_=function t(n){_classCallCheck(this,t),this.name=n.name,this.url=n.url,void 0===n.last_correct?this.last_correct=new Date:this.last_correct=new Date(n.last_correct)},b=function(){function t(){_classCallCheck(this,t),this.attempts=0,this.correct=0,this.streak=0}return _createClass(t,[{key:"addAttempt",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.attempts+=1,t?(this.correct+=1,this.streak+=1):this.streak=0}}],[{key:"fromObject",value:function(n){var e=new t;return e.attempts=n.attempts,e.correct=n.correct,e.streak=n.streak,e}}]),t}();window.Stats=b,window.getStats=t,window.clearStats=n,window.addAttempt=e,window.weightedRand=c,window.weightedRandomN=s,window.readPeople=p,window.main=y}();